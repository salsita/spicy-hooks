# `spicy prepare-release`

Pulls the latest release draft linked to the current Git branch from GitHub and:

* distributes changes from the release notes into appropriate change logs
(based on `changelogs` property within the root `package.json`)

* sets versions within `package.json` of every workspace package to value
specified in the release
(see the [spicy set-version](set-version.md) for more info)

Changes generated by this command are meant to be committed and pushed to the
repository prior publishing the release.

## Configuration

This command expects `changelogs` property within the root `package.json`.
This property defines how release notes of the latest draft release are parsed and distributed to individual changelogs.

```json
{
  "changelogs": {
    "separator": "\n(?=## )",
    "mappings": [
      {
        "pattern": "(.)",
        "file": "CHANGELOG.md"
      },
      {
        "pattern": "^(## ) Package A - ",
        "file": "packages/package-a/CHANGELOG.md"
      },
      {
        "pattern": "^(## ) Package B - ",
        "file": "packages/package-b/CHANGELOG.md"
      }
    ]
  }
}
``` 

The above example splits the release notes by sections using `\n## ` RegExp as a separator.
Individual sections are then prepended to target changelogs based on whether the `pattern` RegExp matches the section.

### `separator`
A regular expression used to split the release notes into individual sections.

**Important:** Note that standard `String.prototype.split()` is used under the hood,
therefore if want to keep the separator in the resulting list,
you need to use the [positive lookahead syntax](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/Regular_Expressions/Assertions#Other_assertions) of regular expressions. 

### `mappings`
List of mappings between individual sections of release notes and their target changelog file.

#### `pattern`
A regular expression pattern that selects sections which should go into the target changelog.

**Important:** Note that the matching string is by default stripped of the text appended to the changelog.
To make selected parts preserved, wrap them into a RegExp capture group (`(preserved) stripped`).
 
#### `file`
Path to a target changelog that should be prepended with the matching sections.
 
## Synopsis

```shell script
spicy prepare-release [--token <github-token>] [--root path]
```

```shell script
spicy prepare-release --help
```

## Options

*  `-t, --token <github-token>`
   * GitHub repo token to list the latest releases from a private repository
   * (defaults to `$GITHUB_TOKEN` env)
                               
* `-r, --root path`
    * Path to the root package (i.e. directory where the root `package.json` is located)
    * (defaults to `./`)
    
* `-h, --help`
    * Display usage guide
